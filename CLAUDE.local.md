# MaisCash - Local AI Agent Rules

> Auto-generated by `/init-local` on 2025-11-22

## ðŸŽ¯ Project Overview

**MaisCash** is a Brazilian fintech platform for consigned loan management, integrating with GovBahia (Government of Bahia) systems.

- **Architecture**: Microservices monorepo with Git submodules
- **Primary Stack**: Java 17 + Spring Boot 3.3.1 + Angular 18
- **Domain**: Consigned loans (emprÃ©stimos consignados)

---

## ðŸ”§ Technology Stack

### Backend
- **Runtime**: Java 17
- **Framework**: Spring Boot 3.3.1 (JHipster 8.6.0)
- **ORM**: Hibernate 6 + JPA
- **Build**: Maven 3.2.5+
- **Migrations**: Liquibase
- **Messaging**: Apache ActiveMQ Artemis 2.30.0

### Frontend
- **Framework**: Angular 18.0.3 (standalone components)
- **Language**: TypeScript 5.4.5
- **UI**: Bootstrap 5 + Material Design
- **Package Manager**: NPM 10.8.1

### Infrastructure
- **Database**: PostgreSQL 15 (prod), H2 (dev)
- **Cache**: Redis 7
- **Containers**: Docker & Docker Compose

---

## ðŸŒ Port Mappings

| Service | Port | Description |
|---------|------|-------------|
| PostgreSQL | 5432 | Database |
| Redis | 6379 | Cache |
| Artemis JMS | 61616 | Message queue |
| Artemis Console | 8161 | MQ management UI |
| MaisCashPro Backend | 8080 | Main API |
| Angular Dev Server | 4200 | Frontend (local) |
| Frontend Docker | 9000 | Frontend (container) |
| Java Debug | 8000 | Remote debugging |

---

## ðŸ“ Key Paths

### Main Services
```
services/MaisCashPro/          # Primary backend service
services/Consig1MS/            # Core microservice
services/Consig1CollectorsMS/  # Data collection
frontend/MaiscashPro-Frontend/ # Angular UI
```

### Configuration
```
services/MaisCashPro/src/main/resources/config/application.yml      # Global
services/MaisCashPro/src/main/resources/config/application-dev.yml  # Dev profile
docker-compose.yml                                                   # Infrastructure
```

### Tests
```
services/*/src/test/java/           # Backend tests (*Test.java, *IT.java)
frontend/*/src/test/javascript/     # Frontend tests (Jest/Jasmine)
```

---

## âš¡ Quick Commands

### Development

```bash
# Full stack (backend + frontend)
npm run watch

# Backend only
cd services/MaisCashPro && ./mvnw

# Frontend only
cd frontend/MaiscashPro-Frontend && npm start

# Infrastructure
docker-compose up postgres artemis redis
```

### Testing

```bash
# Backend unit tests
./mvnw test

# Backend integration tests
./mvnw verify

# Frontend tests
npm test

# All projects
./scripts/test-all.sh
```

### Code Quality

```bash
npm run lint          # ESLint check
npm run lint:fix      # Auto-fix
npm run prettier:format  # Format code
./mvnw checkstyle:check  # Java style
```

### Submodules

```bash
./scripts/pull-all.sh   # Update all
./scripts/build-all.sh  # Build all
git submodule update --init --recursive  # Initialize
```

---

## ðŸ—„ï¸ Database

- **Dev Database**: `maiscash` (PostgreSQL)
- **Credentials**: `maiscash:maiscash123`
- **Migrations**: `services/MaisCashPro/src/main/resources/config/liquibase/`

### Core Entities (Portuguese)
- **Emprestimo** - Loan
- **Consignacao** - Consignment details
- **Margem** - Available margin
- **Operador** - Operator/Staff
- **Equipe** - Team

---

## ðŸ“¨ Message Queues

| Queue | Purpose |
|-------|---------|
| `op_extrato` | Loan data from extrato service |
| `op_extrato-ERROR` | Failed messages |
| `DATABASE_OPERATIONS_QUEUE` | Consig1MS database ops |

---

## ðŸ—ï¸ Architecture Notes

### Data Flow
```
User Request â†’ Consig1MS (WebSocket)
    â†’ Consig1CollectorsMS (scraping)
    â†’ Artemis Queue (op_extrato)
    â†’ MaisCashPro (persistence)
    â†’ Angular Frontend (display)
```

### Package Structure (DDD)
```
br.com.maiscashtech.maiscashpro/
â”œâ”€â”€ domain/        # Entities
â”œâ”€â”€ repository/    # Data access
â”œâ”€â”€ service/       # Business logic
â””â”€â”€ web/rest/      # REST controllers
```

---

## ðŸ” Environment Variables

Required in `.env` or environment:

```bash
# Database
SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/maiscash
SPRING_DATASOURCE_USERNAME=maiscash
SPRING_DATASOURCE_PASSWORD=maiscash123

# Artemis
SPRING_ARTEMIS_BROKER_URL=tcp://localhost:61616

# Redis
SPRING_DATA_REDIS_HOST=localhost
```

---

## ðŸ“‹ Development Rules

### Language
- **Code**: English (variables, methods, classes)
- **Domain**: Portuguese (entity names, comments)
- **Locale**: pt-BR (dates: DD/MM/YYYY, currency: BRL)

### Git Workflow
- Main branch: `main`
- Feature branches: `feature/description`
- Always update submodules before starting work

### Testing Requirements
- Backend: Unit tests required for services
- Frontend: Component tests for UI features
- Integration: Required for API endpoints

---

## ðŸ› Debugging

### Backend (IntelliJ/VSCode)
```bash
npm run backend:debug  # Starts on port 8000
```

### Frontend (Chrome DevTools)
```bash
npm start  # Angular dev server with source maps
```

### Logs
```bash
# Application logs
tail -f services/MaisCashPro/target/*.log

# Docker logs
docker-compose logs -f maiscashpro
```

---

## ðŸ“š Documentation

- **AI Docs**: `ai_docs/` (check `index.json` first)
- **Architecture**: `ai_docs/architecture/`
- **API**: Swagger UI at `http://localhost:8080/swagger-ui.html`

---

## âš ï¸ Important Reminders

1. **UPDATE CHANGELOG.md** for all changes
2. **Check ai_docs/index.json** before creating new docs
3. **Run tests** before committing
4. **Use specific line numbers** in task descriptions
5. **Follow DDD patterns** - domain > repository > service > controller
6. **No hardcoded secrets** - use environment variables

---

## ðŸ”— Related Repositories

| Repo | Purpose |
|------|---------|
| MaisCashPro | Primary backend service |
| MaiscashPro-Frontend | Angular frontend |
| Consig1MS | Core microservice |
| Consig1CollectorsMS | Data collectors |
| consig1 | Shared library |
| extrato | GovBahia integration |
